<!-- telegram_miniapp.html - MVP Telegram Mini‑App for course navigation (Epic‑Gold style)
     Deploy on any static host (GitHub Pages, Vercel) and register in @BotFather > /setdomain
     Uses Telegram Web App SDK https://core.telegram.org/bots/webapps
-->
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Navigation</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --gold: #cfa35c;
      --gold-dark: #8c6e3e;
      --bg: #0a1a2d;
      --card-bg: #11273f;
      --text: #f9f9f9;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Inter", sans-serif;
      background: var(--bg);
      color: var(--text);
    }
    header {
      padding: 1rem;
      text-align: center;
      font-size: 1.5rem;
      font-family: "Cinzel", serif;
      color: var(--gold);
    }

    /* Category grid */
    #categories {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px,1fr));
      gap: 0.75rem;
      padding: 1rem;
    }
    .cat {
      position: relative;
      background: linear-gradient(145deg,var(--card-bg) 0%,#001e41 100%);
      border: 2px solid var(--gold-dark);
      border-radius: 12px;
      aspect-ratio: 1/1;
      display: flex;
      align-items: flex-end;
      padding: 0.5rem;
      overflow: hidden;
      cursor: pointer;
    }
    .cat span {
      font-size: 0.9rem;
      font-weight: 600;
    }
    .badge {
      position: absolute;
      top: 6px;
      right: 6px;
      background: var(--gold);
      color: var(--bg);
      border-radius: 50%;
      padding: 0.2rem 0.45rem;
      font-size: 0.75rem;
      font-weight: 700;
    }

    /* Lesson list */
    #lessons { padding: 1rem; }
    .lesson {
      background: var(--card-bg);
      border: 1px solid var(--gold-dark);
      border-radius: 8px;
      padding: 0.75rem;
      margin-bottom: 0.75rem;
    }
    .lesson h4 { margin: 0 0 0.25rem 0; font-size: 1rem; }
    .progress-bar {
      height: 5px;
      background: var(--bg);
      border-radius: 3px;
      overflow: hidden;
    }
    .progress-bar div { height: 100%; background: var(--gold); width: 0%; }
  </style>
</head>
<body>
  <header>Навигация</header>
  <main id="view">
    <section id="categories" class="grid"></section>
  </main>

  <script>
    const tg = window.Telegram?.WebApp;
    tg?.expand();

    // Dummy data – replace fetches with backend endpoints
    const data = {
      categories: [
        {id:"offers", title:"Офферы", items:27},
        {id:"keys", title:"Ключи", items:34},
        {id:"bans", title:"Баны", items:12},
        {id:"breakdowns", title:"Разборы", items:8}
      ],
      lessons: {
        offers:[{id:1,title:"Security Jobs DE",progress:0},{id:2,title:"Scooter CZ",progress:50}],
        keys:[{id:10,title:"Tier‑1 LSO structure",progress:0}],
        bans:[{id:20,title:"Meta policy update May 2025",progress:100}]
      }
    };

    // Render categories grid
    const catEl = document.getElementById("categories");
    data.categories.forEach(c=>{
      const box=document.createElement("div");box.className="cat";box.dataset.id=c.id;
      box.innerHTML=`<span>${c.title}</span><div class="badge">${c.items}</div>`;
      box.onclick=()=>openCategory(c.id,c.title);
      catEl.appendChild(box);
    });

    function openCategory(id,title){
      document.getElementById("view").innerHTML=`<header style="padding:0 1rem 1rem 1rem"><button onclick="back()" style="background:none;border:none;color:var(--gold);font-size:1.2rem">←</button> ${title}</header><section id='lessons'></section>`;
      const wrap=document.getElementById("lessons");
      (data.lessons[id]||[]).forEach(l=>{
        const card=document.createElement("div");card.className="lesson";
        card.innerHTML=`<h4>${l.title}</h4><div class='progress-bar'><div style='width:${l.progress}%'></div></div>`;
        card.onclick=()=> openLesson(l.id,id);
        wrap.appendChild(card);
      });
    }

    function openLesson(lessonId,catId){
      tg?.openTelegramLink(`https://t.me/your_channel/${lessonId}`);
      // Here you could also mark progress via backend call
    }

    function back(){ location.reload(); }
  </script>
</body>
</html>
